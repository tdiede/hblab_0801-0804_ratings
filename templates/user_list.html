{% extends 'base.html' %}
{% block content %}

<h2>Users</h2>
<h6>*names are fictiously generated using 'namey' API</h6>


<hr class="blur">
<br>

<ul>
{% for user in users %}
  <li id="{{ user.user_id }}"><a href="users/{{ user.user_id }}"></a></li>
  <!-- ({{ user.email }}) -->
{% endfor %}
</ul>


<script type="text/javascript">

const numUsers = {{ num_users|safe }}
console.log(numUsers);

const max = 5;
const apiCalls = 1 + (numUsers / max);



function fillUsernames(numUsers) {
    console.log('ready');

    for(let i=0; i<apiCalls; i++) {
        namey.get({
            count: max,
            with_surname: true,
            callback: function(usernames) {
                console.log(usernames);
                for(let u=1; u<=usernames.length; u++) {
                    let count = i*max + u;
                    let url = "http://i.pravatar.cc/30?u="+count;
                    // let avatar = `<img class="rounded-avatar" src=`+url+` />`;
                    let avatar = `<i class="fa fa-user"></i> `;
                    $("li#"+count+" > a").append(usernames[u-1]).prepend(avatar);
                }
            }
        });
    }
}

$(document).ready(fillUsernames(numUsers));

</script>

{% endblock %}
